<!DOCTYPE html>
<html lang="uk">
<head>
<meta charset="UTF-8">
<title>–§–æ—Ä—É–º –∑ —Ç–µ–º–∞–º–∏</title>
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<style>
body{margin:0;font-family:Arial,sans-serif;background:#0f111a;color:#eee;}
header{background:#151826;padding:15px 20px;display:flex;justify-content:space-between;align-items:center;font-size:24px;font-weight:bold;}
#headerLeft{display:flex;align-items:center;gap:15px;}
#headerLeft button{padding:5px 12px;border:none;background:#ff6a00;color:#fff;border-radius:5px;cursor:pointer;font-size:16px;}
#userAccount{display:flex;align-items:center;gap:10px;}
#userAccount span{font-size:18px;color:#fff;}
#userAccount button{padding:5px 10px;border:none;background:#ff6a00;color:#fff;border-radius:5px;cursor:pointer;}
#userAccount img{width:40px;height:40px;border-radius:50%;object-fit:cover;cursor:pointer;border:2px solid #1976d2;}
.container{max-width:900px;margin:20px auto;background:#151826;padding:15px;border-radius:10px;}
.tabs{display:flex;gap:10px;}
.tab{padding:10px 15px;background:#1f2236;border-radius:5px;cursor:pointer;}
.tab.active{background:#ff6a00;}
.create-btn{margin:15px 0;padding:10px 15px;background:#ff6a00;border:none;color:#fff;border-radius:5px;cursor:pointer;}
.topic{padding:12px;background:#1f2236;margin-bottom:8px;border-radius:5px;cursor:pointer;}
.topic:hover{background:#2a2e4a;}
.topic[data-prefix="–ì–æ–ª–æ–≤–Ω–µ"]{background:#2e7d32;} 
.topic[data-prefix="–û—á—ñ–∫—É–≤–∞–Ω–Ω—è"]{background:#fff;color:#000;} 
.topic[data-prefix="–°—Ö–≤–∞–ª–µ–Ω–æ"]{background:#1976d2;} 
#overlay,#registerOverlay,#roleOverlay,#playersOverlay,#actionOverlay{display:none;position:fixed;inset:0;background:rgba(0,0,0,.6);z-index:1000;}
#editor,#registerBox,#roleBox,#playersBox,#actionBox{display:none;position:fixed;top:50%;left:50%;transform:translate(-50%,-50%);width:90%;max-width:700px;background:#0f111a;padding:20px;border-radius:10px;z-index:1001;}
input,textarea,select{width:100%;background:#1f2236;border:none;color:#fff;padding:10px;margin-bottom:10px;border-radius:5px;}
table{width:100%;border-collapse:collapse;margin-top:10px;}
th,td{padding:8px;border-bottom:1px solid #333;text-align:left;}
.status-online{color:#0f0;}
.status-offline{color:#f00;}
a.forum-link{color:#4da6ff;font-weight:600;text-decoration:none;}
a.external-link{color:#ff4d4d;font-weight:600;text-decoration:underline;}
</style>
</head>
<body>

<header>
<div id="headerLeft">
  <span>–§–æ—Ä—É–º</span>
  <button id="rolesBtn" style="display:none;" onclick="openRoleManager()">–†–æ–ª—ñ</button>
  <button id="playersBtn" onclick="openPlayers()">–ì—Ä–∞–≤—Ü—ñ</button>
</div>
<div id="userAccount">
  <img id="avatar" src="">
  <span id="username"></span>
  <span id="userRole" style="font-size:14px;color:#aaa"></span>
  <button onclick="logout()">–í–∏–π—Ç–∏</button>
  <input type="file" id="avatarInput" accept="image/*" style="display:none">
</div>
</header>

<div class="container" id="forum">
  <div class="tabs">
    <div class="tab active" onclick="switchTab('rules')">–ü—Ä–∞–≤–∏–ª–∞</div>
    <div class="tab" onclick="switchTab('database')">–ë–∞–∑–∞ –¥–∞–Ω–∏—Ö</div>
    <div class="tab" onclick="switchTab('senior')">–°—Ç–∞—Ä—à—ñ</div>
  </div>
  <button class="create-btn" onclick="openEditor()">‚ûï –°—Ç–≤–æ—Ä–∏—Ç–∏ —Ç–µ–º—É</button>
  <button class="create-btn" onclick="openRegister()">üìù –†–µ—î—Å—Ç—Ä–∞—Ü—ñ—è</button>
  <div id="topics"></div>
</div>

<div id="threadView" style="display:none;"></div>

<!-- –°—Ç–≤–æ—Ä–µ–Ω–Ω—è —Ç–µ–º–∏ -->
<div id="overlay"></div>
<div id="editor">
<h2>–°—Ç–≤–æ—Ä–∏—Ç–∏ —Ç–µ–º—É</h2>
<input id="topicTitle" placeholder="–ó–∞–≥–æ–ª–æ–≤–æ–∫ —Ç–µ–º–∏">
<select id="topicPrefix">
<option value="–ì–æ–ª–æ–≤–Ω–µ">üü¢ –ì–æ–ª–æ–≤–Ω–µ</option>
<option value="–û—á—ñ–∫—É–≤–∞–Ω–Ω—è">‚ö™ –û—á—ñ–∫—É–≤–∞–Ω–Ω—è</option>
<option value="–°—Ö–≤–∞–ª–µ–Ω–æ">üîµ –°—Ö–≤–∞–ª–µ–Ω–æ</option>
</select>
<textarea id="topicText" rows="6" placeholder="–¢–µ–∫—Å—Ç —Ç–µ–º–∏"></textarea>
<button class="create-btn" onclick="publish()">–û–ø—É–±–ª—ñ–∫—É–≤–∞—Ç–∏</button>
<button class="create-btn" onclick="closeEditor()">–°–∫–∞—Å—É–≤–∞—Ç–∏</button>
</div>

<!-- –†–æ–ª—ñ -->
<div id="roleOverlay"></div>
<div id="roleBox">
<h2>–£–ø—Ä–∞–≤–ª—ñ–Ω–Ω—è –∫–æ—Ä–∏—Å—Ç—É–≤–∞—á–∞–º–∏</h2>
<select id="roleUserSelect"></select>
<select id="roleSelect">
<option value="–ì—Ä–∞–≤–µ—Ü—å">–ì—Ä–∞–≤–µ—Ü—å</option>
<option value="–ú–æ–¥–µ—Ä–∞—Ç–æ—Ä">–ú–æ–¥–µ—Ä–∞—Ç–æ—Ä</option>
<option value="–ê–¥–º—ñ–Ω—ñ—Å—Ç—Ä–∞—Ç–æ—Ä">–ê–¥–º—ñ–Ω—ñ—Å—Ç—Ä–∞—Ç–æ—Ä</option>
</select>
<select id="punishSelect">
<option value="">–ë–µ–∑ –ø–æ–∫–∞—Ä–∞–Ω–Ω—è</option>
<option value="mute">–ú—É—Ç</option>
<option value="ban">–ë–∞–Ω</option>
</select>
<button class="create-btn" onclick="assignRoleAndPunish()">–ó–∞—Å—Ç–æ—Å—É–≤–∞—Ç–∏</button>
<button class="create-btn" onclick="closeRoleManager()">–°–∫–∞—Å—É–≤–∞—Ç–∏</button>
</div>

<!-- –ì—Ä–∞–≤—Ü—ñ -->
<div id="playersOverlay"></div>
<div id="playersBox">
<h2>–ì—Ä–∞–≤—Ü—ñ –§–æ—Ä—É–º—É</h2>
<table id="playersTable"><tr><th>–Ü–º'—è</th><th>–°—Ç–∞—Ç—É—Å</th></tr></table>
<button class="create-btn" onclick="closePlayers()">–ó–∞–∫—Ä–∏—Ç–∏</button>
</div>

<script>
/* ---------- USERS ---------- */
let users = JSON.parse(localStorage.getItem('forumUsers')||'{}');
if(!users['–ê–Ω—Ç–æ–Ω –ê—Ä–æ–Ω—ñ–≤']){
  users['–ê–Ω—Ç–æ–Ω –ê—Ä–æ–Ω—ñ–≤']={role:'–ê–¥–º—ñ–Ω—ñ—Å—Ç—Ä–∞—Ç–æ—Ä',avatar:'https://via.placeholder.com/40',online:true};
  localStorage.setItem('forumUsers',JSON.stringify(users));
}
let currentUser = localStorage.getItem('forumUser')||'–ê–Ω—Ç–æ–Ω –ê—Ä–æ–Ω—ñ–≤';
users[currentUser].online = true;
localStorage.setItem('forumUsers',JSON.stringify(users));
document.getElementById('username').textContent = currentUser;
document.getElementById('userRole').textContent = users[currentUser].role;
if(users[currentUser].role==='–ê–¥–º—ñ–Ω—ñ—Å—Ç—Ä–∞—Ç–æ—Ä') document.getElementById('rolesBtn').style.display='inline-block';
let avatarImg = document.getElementById('avatar');
avatarImg.src = users[currentUser].avatar;
avatarImg.onclick = ()=>document.getElementById('avatarInput').click();
document.getElementById('avatarInput').addEventListener('change', function(){
  const file=this.files[0];
  if(file){
    const reader=new FileReader();
    reader.onload=function(e){
      avatarImg.src=e.target.result;
      users[currentUser].avatar=e.target.result;
      localStorage.setItem('forumUsers',JSON.stringify(users));
    };
    reader.readAsDataURL(file);
  }
});
function logout(){ users[currentUser].online=false; localStorage.setItem('forumUsers',JSON.stringify(users)); localStorage.removeItem('forumUser'); location.reload(); }

/* ---------- FORUM ---------- */
let currentTab='rules';
function getData(){ return JSON.parse(localStorage.getItem('forumTopics')||'{}'); }
function saveData(d){ localStorage.setItem('forumTopics',JSON.stringify(d)); }
function switchTab(tab){ currentTab=tab; document.querySelectorAll('.tab').forEach(t=>t.classList.remove('active')); event.target.classList.add('active'); render(); }
function render(){
  const box = document.getElementById('topics');
  box.innerHTML='';
  const data = getData();
  (data[currentTab]||[]).forEach(t=>{
    const div=document.createElement('div');
    div.className='topic';
    div.dataset.prefix=t.prefix;
    div.textContent=t.title;
    div.onclick = ()=>openThread(t.id);
    box.appendChild(div);
  });
}
function openEditor(){overlay.style.display='block';editor.style.display='block';}
function closeEditor(){overlay.style.display='none';editor.style.display='none';}
function publish(){
  if(!topicTitle.value||!topicText.value) return alert('–ó–∞–ø–æ–≤–Ω—ñ—Ç—å –≤—Å–µ');
  const d=getData();
  if(!d[currentTab]) d[currentTab]=[];
  d[currentTab].push({id:Date.now(),title:topicTitle.value,text:topicText.value,prefix:topicPrefix.value});
  saveData(d);
  closeEditor();
  topicTitle.value='';
  topicText.value='';
  render();
}

/* ---------- THREAD with ACTIONS ---------- */
function openThread(id){
  const t=Object.values(getData()).flat().find(x=>x.id===id);
  if(!t) return;
  document.getElementById('forum').style.display='none';
  document.getElementById('threadView').style.display='block';
  document.getElementById('threadView').innerHTML = `
    <header style="display:flex;justify-content:space-between;align-items:center;">
      <span>${t.title}</span>
      <div>
        <button onclick="closeThread()">‚¨Ö –ù–∞–∑–∞–¥</button>
        ${['–ê–¥–º—ñ–Ω—ñ—Å—Ç—Ä–∞—Ç–æ—Ä','–ú–æ–¥–µ—Ä–∞—Ç–æ—Ä'].includes(users[currentUser].role)?'<button onclick="openActions('+t.id+')">–î—ñ—ó</button>':''}
      </div>
    </header>
    <div class="container">
      <p style="white-space:pre-wrap;">${t.text}</p>
    </div>
  `;
}
function closeThread(){ document.getElementById('threadView').style.display='none'; document.getElementById('forum').style.display='block'; }

/* ---------- ACTIONS ---------- */
function openActions(topicId){
  const overlay=document.getElementById('actionOverlay')||document.createElement('div');
  overlay.id='actionOverlay';
  overlay.style.cssText='position:fixed;inset:0;background:rgba(0,0,0,0.6);z-index:1000;';
  document.body.appendChild(overlay);
  overlay.style.display='block';

  const box=document.getElementById('actionBox')||document.createElement('div');
  box.id='actionBox';
  box.style.cssText='position:fixed;top:50%;left:50%;transform:translate(-50%,-50%);width:90%;max-width:400px;background:#0f111a;padding:20px;border-radius:10px;z-index:1001;';
  box.innerHTML = `
    <h2>–î—ñ—ó –∑ —Ç–µ–º–æ—é</h2>
    <button onclick="deleteTopic(${topicId})">–í–∏–¥–∞–ª–∏—Ç–∏ —Ç–µ–º—É</button>
    <button onclick="closeActions()">–°–∫–∞—Å—É–≤–∞—Ç–∏</button>
  `;
  document.body.appendChild(box);
  box.style.display='block';
}
function closeActions(){ const overlay=document.getElementById('actionOverlay'); const box=document.getElementById('actionBox'); if(overlay) overlay.style.display='none'; if(box) box.style.display='none'; }
function deleteTopic(topicId){ if(!confirm('–í–∏ —Ç–æ—á–Ω–æ —Ö–æ—á–µ—Ç–µ –≤–∏–¥–∞–ª–∏—Ç–∏ —Ü—é —Ç–µ–º—É?')) return; let data=getData(); Object.keys(data).forEach(tab=>{ data[tab]=data[tab].filter(t=>t.id!==topicId); }); saveData(data); closeActions(); closeThread(); render(); }

/* ---------- ROLE & PLAYERS ---------- */
function openRoleManager(){ roleOverlay.style.display='block'; roleBox.style.display='block'; const sel=document.getElementById('roleUserSelect'); sel.innerHTML=''; Object.keys(users).forEach(u=>{ if(u!==currentUser) sel.innerHTML+=`<option value="${u}">${u}</option>`; }); }
function closeRoleManager(){ roleOverlay.style.display='none'; roleBox.style.display='none'; }
function assignRoleAndPunish(){ const u=document.getElementById('roleUserSelect').value; const r=document.getElementById('roleSelect').value; const p=document.getElementById('punishSelect').value; if(!u) return; users[u].role=r; users[u].muted=p==='mute'; users[u].banned=p==='ban'; localStorage.setItem('forumUsers',JSON.stringify(users)); alert(`–ö–æ—Ä–∏—Å—Ç—É–≤–∞—á—É ${u} –ø—Ä–∏–∑–Ω–∞—á–µ–Ω–æ —Ä–æ–ª—å ${r} —Ç–∞ –ø–æ–∫–∞—Ä–∞–Ω–Ω—è: ${p||'–Ω–µ–º–∞—î'}`); closeRoleManager(); }

function openPlayers(){ playersOverlay.style.display='block'; playersBox.style.display='block'; const tbl=document.getElementById('playersTable'); tbl.innerHTML='<tr><th>–Ü–º\'—è</th><th>–°—Ç–∞—Ç—É—Å</th></tr>'; Object.keys(users).forEach(u=>{ const row=document.createElement('tr'); const tdName=document.createElement('td'); tdName.textContent=u; const tdStatus=document.createElement('td'); tdStatus.textContent=users[u].online?'online':'offline'; tdStatus.style.color=users[u].online?'#0f0':'#f00'; row.appendChild(tdName); row.appendChild(tdStatus); tbl.appendChild(row); }); }
function closePlayers(){ playersOverlay.style.display='none'; playersBox.style.display='none'; }

render();
</script>
</body>
</html>
