<!DOCTYPE html>
<html lang="uk">
<head>
<meta charset="UTF-8">
<title>–§–æ—Ä—É–º –ß—é–¥–æ–≤–æ</title>
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<style>
body {margin:0;font-family:Arial,sans-serif;background:#0f111a;color:#eee;overflow-x:hidden;}
header {background:#151826;padding:15px 20px;display:flex;justify-content:space-between;align-items:center;}
#headerLeft {display:flex;gap:10px;align-items:center;}
button {background:#ff6a00;border:none;color:#fff;padding:6px 12px;border-radius:6px;cursor:pointer;}
button:hover {opacity:.85;}
.container {max-width:900px;margin:20px auto;background:#151826;padding:15px;border-radius:10px;}
.topic {background:#1f2236;padding:10px;border-radius:6px;margin-bottom:8px;cursor:pointer;display:flex;justify-content:space-between;align-items:center;}
.topic:hover {background:#2a2e4a;}
.tab {padding:8px 12px;background:#1f2236;border-radius:6px;cursor:pointer;user-select:none;}
.tab.active {background:#ff6a00;}
#userAccount {display:flex;gap:10px;align-items:center;}
#avatar {width:40px;height:40px;border-radius:50%;cursor:pointer;border:2px solid #ff6a00;}
.overlay {display:none;position:fixed;inset:0;background:rgba(0,0,0,.6);z-index:1000;}
.modal {display:none;position:fixed;top:50%;left:50%;transform:translate(-50%,-50%);background:#0f111a;padding:20px;border-radius:10px;z-index:1001;width:90%;max-width:500px;}
input,textarea,select {width:100%;background:#1f2236;border:none;color:#fff;padding:10px;border-radius:6px;margin-bottom:10px;}
table {width:100%;color:#fff;border-collapse:collapse;}
td,th {border-bottom:1px solid #333;padding:6px;text-align:left;}
.snow {position:fixed;top:-10px;color:#fff;animation:fall linear infinite;pointer-events:none;}
@keyframes fall {to{transform:translateY(100vh);}}
</style>
</head>
<body>

<header>
  <div id="headerLeft">
    <b>–§–æ—Ä—É–º –ß—é–¥–æ–≤–æ</b>
    <button id="rolesBtn" onclick="openRoleManager()">–†–æ–ª—ñ</button>
    <button onclick="openPlayers()">–ì—Ä–∞–≤—Ü—ñ</button>
  </div>
  <div id="userAccount">
    <img id="avatar" src="https://via.placeholder.com/40">
    <span id="username">–ì—Ä–∞–≤–µ—Ü—å</span>
    <span id="userRole" style="font-size:13px;color:#aaa">–ì—Ä–∞–≤–µ—Ü—å</span>
    <button onclick="logout()">–í–∏–π—Ç–∏</button>
    <input type="file" id="avatarInput" accept="image/*" hidden>
  </div>
</header>

<div class="container" id="forum">
  <div style="display:flex;gap:10px">
    <div class="tab active" onclick="switchTab(event,'rules')">–ü—Ä–∞–≤–∏–ª–∞</div>
    <div class="tab" onclick="switchTab(event,'database')">–ë–∞–∑–∞</div>
    <div class="tab" onclick="switchTab(event,'senior')">–°—Ç–∞—Ä—à—ñ</div>
  </div>
  <br>
  <button onclick="openEditor()">‚ûï –°—Ç–≤–æ—Ä–∏—Ç–∏ —Ç–µ–º—É</button>
  <div id="topics"></div>
</div>

<div id="threadView" class="container" style="display:none"></div>

<!-- overlay -->
<div class="overlay" id="overlay"></div>

<!-- Modal: –ù–æ–≤–∞ —Ç–µ–º–∞ -->
<div class="modal" id="editor">
  <h2>–ù–æ–≤–∞ —Ç–µ–º–∞</h2>
  <input id="topicTitle" placeholder="–ó–∞–≥–æ–ª–æ–≤–æ–∫">
  <textarea id="topicText" rows="5" placeholder="–¢–µ–∫—Å—Ç"></textarea>
  <button onclick="publish()">–û–ø—É–±–ª—ñ–∫—É–≤–∞—Ç–∏</button>
  <button onclick="closeEditor()">–°–∫–∞—Å—É–≤–∞—Ç–∏</button>
</div>

<!-- Modal: –†–æ–ª—ñ -->
<div class="modal" id="roleBox">
  <h2>–£–ø—Ä–∞–≤–ª—ñ–Ω–Ω—è</h2>
  <select id="roleUserSelect"></select>
  <select id="roleSelect">
    <option>–ì—Ä–∞–≤–µ—Ü—å</option>
    <option>–ú–æ–¥–µ—Ä–∞—Ç–æ—Ä</option>
    <option>–ê–¥–º—ñ–Ω—ñ—Å—Ç—Ä–∞—Ç–æ—Ä</option>
  </select>
  <button onclick="assignRole()">–ó–∞—Å—Ç–æ—Å—É–≤–∞—Ç–∏</button>
  <button onclick="closeRoleManager()">–ó–∞–∫—Ä–∏—Ç–∏</button>
</div>

<!-- Modal: –ì—Ä–∞–≤—Ü—ñ -->
<div class="modal" id="playersBox">
  <h2>–ì—Ä–∞–≤—Ü—ñ</h2>
  <table id="playersTable"></table>
  <button onclick="closePlayers()">–ó–∞–∫—Ä–∏—Ç–∏</button>
</div>

<script>
// --- –õ–æ–∫–∞–ª—å–Ω—ñ –¥–∞–Ω—ñ ---
let tab = "rules";
let topicsData = {rules:[], database:[], senior:[]};
let userData = {nick:"–ì—Ä–∞–≤–µ—Ü—å", role:"–ì—Ä–∞–≤–µ—Ü—å", avatar:"https://via.placeholder.com/40"};

// --- DOM –µ–ª–µ–º–µ–Ω—Ç–∏ ---
const avatar = document.getElementById('avatar');
const avatarInput = document.getElementById('avatarInput');
const username = document.getElementById('username');
const userRole = document.getElementById('userRole');

// --- –ê–≤–∞—Ç–∞—Ä–∫–∞ ---
avatar.onclick = ()=> avatarInput.click();
avatarInput.onchange = e=>{
  const reader = new FileReader();
  reader.onload = x => { avatar.src = x.target.result; userData.avatar = x.target.result; }
  reader.readAsDataURL(e.target.files[0]);
}

// --- Logout ---
function logout(){ location.reload(); }

// --- –í–∫–ª–∞–¥–∫–∏ ---
function switchTab(e,t){
  tab = t;
  document.querySelectorAll('.tab').forEach(x=>x.classList.remove('active'));
  e.currentTarget.classList.add('active');
  render();
}

// --- –¢–µ–º–∏ ---
function openEditor(){overlay.style.display=editor.style.display="block";}
function closeEditor(){overlay.style.display=editor.style.display="none";}

function publish(){
  const title = topicTitle.value.trim();
  const text = topicText.value.trim();
  if(!title || !text) return alert("–í–≤–µ–¥—ñ—Ç—å –∑–∞–≥–æ–ª–æ–≤–æ–∫ —Ç–∞ —Ç–µ–∫—Å—Ç");
  topicsData[tab].push({title,text,author:userData.nick});
  closeEditor();
  render();
}

function render(){
  const topics = document.getElementById('topics');
  topics.innerHTML="";
  topicsData[tab].forEach((t,i)=>{
    const d = document.createElement("div");
    d.className = "topic";
    d.innerHTML = `<span>${t.title}</span>`;
    if(userData.role !== "–ì—Ä–∞–≤–µ—Ü—å"){
      const x = document.createElement("button");
      x.textContent = "‚ùå";
      x.onclick = e => { e.stopPropagation(); topicsData[tab].splice(i,1); render(); };
      d.appendChild(x);
    }
    d.onclick = ()=> openThread(t);
    topics.appendChild(d);
  });
}

// --- –í—ñ–¥–∫—Ä–∏—Ç–∏ —Ç–µ–º—É ---
function openThread(t){
  document.getElementById('forum').style.display = 'none';
  const threadView = document.getElementById('threadView');
  threadView.style.display = 'block';
  threadView.innerHTML = `<h2>${t.title}</h2><p>${t.text}</p><button onclick="closeThread()">–ù–∞–∑–∞–¥</button>`;
}
function closeThread(){
  document.getElementById('forum').style.display = 'block';
  document.getElementById('threadView').style.display = 'none';
}

// --- –†–æ–ª—ñ ---
function openRoleManager(){
  overlay.style.display=roleBox.style.display="block";
  const select = document.getElementById('roleUserSelect');
  select.innerHTML="";
  const opt = document.createElement('option');
  opt.value = 0; opt.textContent = userData.nick;
  select.appendChild(opt);
}
function closeRoleManager(){overlay.style.display=roleBox.style.display="none";}
function assignRole(){
  userData.role = document.getElementById('roleSelect').value;
  userRole.textContent = userData.role;
  closeRoleManager();
}

// --- –ì—Ä–∞–≤—Ü—ñ ---
function openPlayers(){
  overlay.style.display=playersBox.style.display="block";
  const table = document.getElementById('playersTable');
  table.innerHTML = "<tr><th>–ù—ñ–∫</th><th>–†–æ–ª—å</th><th>–°—Ç–∞—Ç—É—Å</th></tr>";
  table.innerHTML += `<tr><td>${userData.nick}</td><td>${userData.role}</td><td>üü¢</td></tr>`;
}
function closePlayers(){overlay.style.display=playersBox.style.display="none";}

// --- –ö–ª—ñ–∫ –ø–æ overlay –∑–∞–∫—Ä–∏–≤–∞—î –º–æ–¥–∞–ª–∫–∏ ---
document.getElementById('overlay').onclick = ()=>{
  document.querySelectorAll('.modal').forEach(m=>m.style.display='none');
  overlay.style.display='none';
}

// --- –°–Ω—ñ–≥ ---
for(let i=0;i<40;i++){
  const s = document.createElement("div");
  s.className = "snow"; s.textContent="‚ùÑ";
  s.style.left=Math.random()*100+"vw";
  s.style.animationDuration=(3+Math.random()*5)+"s";
  document.body.appendChild(s);
}

// --- –ü–æ—á–∞—Ç–∫–æ–≤–∏–π —Ä–µ–Ω–¥–µ—Ä ---
render();
</script>

</body>
</html>
